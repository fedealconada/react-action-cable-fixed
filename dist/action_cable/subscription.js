var EventEmitter,Subscription,extend=function(t,e){function i(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};EventEmitter=require("eventemitter3"),Subscription=function(t){function e(t,e,i){this.subscriptions=t,null==e&&(e={}),this.actions=null!=i?i:[],this.identifier=JSON.stringify(e),this.subscriptions.add(this),this.consumer=this.subscriptions.consumer}return extend(e,t),e.prototype.perform=function(t,e){return null==e&&(e={}),e.action=t,this.send(e)},e.prototype.send=function(t){return this.consumer.send({command:"message",identifier:this.identifier,data:JSON.stringify(t)})},e.prototype.unsubscribe=function(){return this.subscriptions.remove(this)},e.prototype.connected=function(){return this.emit("connected")},e.prototype.disconnected=function(){return this.emit("disconnected")},e.prototype.rejected=function(){return this.emit("rejected")},e.prototype.received=function(t){var e;return e=t.action,indexOf.call(this.actions,e)>=0?this.emit(t.action,t):this.emit("received",t)},e}(EventEmitter),module.exports=Subscription;